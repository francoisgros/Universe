<!DOCTYPE html>
<html>
<head>
    <title>Star Universe - Babylon.js</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
        }
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        #hud {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            height: 180px;
            background: rgba(0, 0, 51, 0.85);
            border: 1px solid #00fff7;
            border-radius: 5px;
            color: #00fff7;
            font-family: 'Orbitron', sans-serif;
            padding: 10px;
            display: flex;
            pointer-events: none;
        }
        .star-preview {
            width: 100px;
            height: 100px;
            margin-right: 10px;
        }
        .star-info {
            flex: 1;
        }
        .star-name {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .star-distance {
            font-size: 14px;
            color: #445566;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <div id="hud">
        <canvas class="star-preview"></canvas>
        <div class="star-info">
            <div class="star-name">[ NO TARGET ]</div>
            <div class="star-distance">---</div>
        </div>
    </div>
    
    <!-- Babylon.js -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    
    <!-- Application -->
    <script type="module" src="universe.js"></script>>
    <!-- Génération d'étoile externalisée -->
    <script src="star-factory.js"></script>
    <!-- Étoile générée dynamiquement par star-factory.js -->
    
    <a-camera position="0 1.6 0">
      <!-- Curseur principal -->
      <a-entity id="star-cursor" 
        position="0 0 -1"
        raycaster="objects: .star-interactive; far: 100; interval: 100"
        star-hover>
        <!-- Raycaster principal avec une portée augmentée -->
        <a-entity
          id="star-raycaster"
          raycaster="objects: .star-interactive; showLine: true; far: 10000; lineColor: #00fff7; lineOpacity: 0.5; interval: 0"
          cursor="fuse: false; rayOrigin: mouse">
        </a-entity>
        
        <!-- Cercles du curseur -->
        <a-entity
          geometry="primitive: ring; radiusInner: 0.06; radiusOuter: 0.065; segmentsTheta: 32"
          material="shader: flat; color: #00fff7; opacity: 0.7; transparent: true"
          animation__rotate="property: rotation; to: 0 0 360; loop: true; dur: 8000; easing: linear">
        </a-entity>
        <a-entity
          geometry="primitive: ring; radiusInner: 0.04; radiusOuter: 0.042; segmentsTheta: 32"
          material="shader: flat; color: #00fff7; opacity: 0.9; transparent: true"
          animation__rotate="property: rotation; to: 0 0 -360; loop: true; dur: 12000; easing: linear">
        </a-entity>
        
        <!-- Points cardinaux -->
        <a-entity
          geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.054; thetaStart: 0; thetaLength: 4; segmentsTheta: 1"
          material="shader: flat; color: #00fff7"
          position="0 0 0"
          rotation="0 0 0">
        </a-entity>
        <a-entity
          geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.054; thetaStart: 0; thetaLength: 4; segmentsTheta: 1"
          material="shader: flat; color: #00fff7"
          position="0 0 0"
          rotation="0 0 90">
        </a-entity>
        <a-entity
          geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.054; thetaStart: 0; thetaLength: 4; segmentsTheta: 1"
          material="shader: flat; color: #00fff7"
          position="0 0 0"
          rotation="0 0 180">
        </a-entity>
        <a-entity
          geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.054; thetaStart: 0; thetaLength: 4; segmentsTheta: 1"
          material="shader: flat; color: #00fff7"
          position="0 0 0"
          rotation="0 0 270">
        </a-entity>
        
        <!-- Point central -->
        <a-entity
          geometry="primitive: ring; radiusInner: 0.002; radiusOuter: 0.006"
          material="shader: flat; color: #00fff7; opacity: 0.9"
          animation__pulse="property: scale; from: 0.8 0.8 0.8; to: 1.2 1.2 1.2; dir: alternate; dur: 1000; loop: true; easing: easeInOutSine">
        </a-entity>
      </a-entity>
    </a-camera>
    <a-sky color="#000"></a-sky>
    <a-entity post-processing="bloom: true; bloomStrength: 2"></a-entity>
  </a-scene>

  <!-- Shaders -->
  <script type="x-shader/x-vertex" id="vertexShader">
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  </script>

  <script type="x-shader/x-fragment" id="fragmentShader">
    uniform float time;
    uniform vec3 color1;
    uniform vec3 color2;
    uniform vec3 color3;
    uniform float colorSpeed;
    varying vec2 vUv;

    // Les fonctions de bruit et plasma sont injectées par star-shader.js
    void main() {
      vec2 uv = vUv * 2.0 - 1.0;
      float radius = length(uv);

      // Animation de couleur
      float t = time * colorSpeed;
      vec3 baseColor = mix(mix(color1, color2, 0.5 + 0.5*sin(t)), color3, 0.5 + 0.5*cos(t));

      // Motif plasma : superposition de sin/cos et bruit
      float p = plasma(uv, t);
      baseColor = mix(baseColor, vec3(1.0,1.0,1.0), p * 0.35);

      // Effet de couronne
      float edge = pow(1.0 - radius, 4.0);
      baseColor += edge * mix(color2, color3, 0.5);

      gl_FragColor = vec4(baseColor * (1.0 + edge * 2.0), 1.0);
    }
  </script>

  <!-- Composant personnalisé -->
  <script src="star-shader.js"></script>
  <script src="star-factory.js"></script>
  <script src="star-hover.js"></script>
  <script src="star-interaction.js"></script>
</body>
</html>
